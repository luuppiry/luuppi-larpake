<!DOCTYPE html>
<html lang="fi">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Luuppi - Lärpäke</title>
        <link rel="stylesheet" href="/styles/larpake.css" />
        <script type="module" src="/src/components/ui-header.js"></script>
        <script type="module" src="/src/components/side-panel.js"></script>
    </head>
    <body>
        <template id="title-template">
            <li>
                <article>
                    <h3 class="_title section-title"></h3>
                </article>
            </li>
        </template>

        <template id="task-template">
            <li>
                <h3 class="task-title">
                    <span class="_title"></span>
                    <span class="_points">0</span>
                </h3>
                <a class="_link _signature task-btn hover-scale-03">
                    <h4 class="_state">SUORITETTU</h4>
                </a>
            </li>
        </template>

        <ui-header side-panel-name="side-panel-element"></ui-header>
        <side-panel lang="fi"></side-panel>
        <div class="page">
            <h2 id="larpake-page-name">Lärpäke</h2>
            <ul id="larpake-task-container" class="task-container">
                <!-- Buttons will be dynamically generated here -->

                <!-- Placeholder -->
                <li>
                    <article>
                        <h3 class="_title section-title loader">&nbsp;</h3>
                    </article>
                </li>
                <li>
                    <article>
                        <h3 class="task-title loader">&nbsp;</h3>
                        <button class="_btn _signature task-btn loader"></button>
                    </article>
                </li>
                <li>
                    <article>
                        <h3 class="task-title loader">&nbsp;</h3>
                        <button class="_btn _signature task-btn loader"></button>
                    </article>
                </li>
                <li>
                    <article>
                        <h3 class="task-title loader">&nbsp;</h3>
                        <button class="_btn _signature task-btn loader"></button>
                    </article>
                </li>
                <li>
                    <article>
                        <h3 class="task-title loader">&nbsp;</h3>
                        <button class="_btn _signature task-btn loader"></button>
                    </article>
                </li>
                <li>
                    <article>
                        <h3 class="task-title loader">&nbsp;</h3>
                        <button class="_btn _signature task-btn loader"></button>
                    </article>
                </li>
                <li>
                    <article>
                        <h3 class="task-title loader">&nbsp;</h3>
                        <button class="_btn _signature task-btn loader"></button>
                    </article>
                </li>
            </ul>
            <div class="pagination">
                <button id="prev-page" disabled>&lt;</button>
                <span id="page-info">1 / 1</span>
                <button id="next-page" disabled>&gt;</button>
            </div>
        </div>
    </body>
    <script type="module" src="/src/larpake.js"></script>
    <script type="module">
        const page = document.querySelector(".page");
        let startX = 0;
        let currentX = 0;
        let isDragging = false;
        let animationFrame;

        const swipeThreshold = 100;

        page.addEventListener("mousedown", startDrag);
        page.addEventListener("touchstart", startDrag, { passive: true });

        window.addEventListener("mousemove", onDrag);
        window.addEventListener("touchmove", onDrag, { passive: false });

        window.addEventListener("mouseup", endDrag);
        window.addEventListener("touchend", endDrag);

        function startDrag(e) {
            isDragging = true;
            startX = getX(e);
            currentX = startX;
            page.style.transition = "none";
            cancelAnimationFrame(animationFrame);
        }

        function onDrag(e) {
            if (!isDragging) return;

            currentX = getX(e);
            const deltaX = currentX - startX;

            animationFrame = requestAnimationFrame(() => {
                page.style.transform = `translateX(${deltaX}px)`;
            });
        }

        function endDrag() {
            if (!isDragging) return;
            isDragging = false;

            const deltaX = currentX - startX;
            page.style.transition = "transform 0.3s ease";

            if (Math.abs(deltaX) > swipeThreshold) {
                if (deltaX > 0) {
                    // Swipe right → previous page
                    page.style.transform = "translateX(100%)";
                    setTimeout(() => {
                        document.getElementById("prev-page").click();
                        page.style.transform = "translateX(0)";
                    }, 300);
                } else {
                    // Swipe left → next page
                    page.style.transform = "translateX(-100%)";
                    setTimeout(() => {
                        document.getElementById("next-page").click();
                        page.style.transform = "translateX(0)";
                    }, 300);
                }
            } else {
                // Not enough movement → reset
                page.style.transform = "translateX(0)";
            }
        }

        function getX(e) {
            return e.touches ? e.touches[0].clientX : e.clientX;
        }
    </script>
</html>
